from flask import Flask, render_template_string, request, redirect, url_for, session
import random
import math

app = Flask(__name__)
app.secret_key = 'chave_secreta'

# Gêneros de filmes (sem incluir musicais)
generos = ['Ação', 'Comédia', 'Drama', 'Romance', 'Terror', 'Ficção Científica', 'Aventura']

# Filmes fictícios para demonstração
filmes = [
    {'titulo': 'Vingadores', 'genero': 'Ação', 'poster': 'https://via.placeholder.com/150', 'avaliacao': 4, 'descricao': 'A batalha para salvar o mundo.'},
    {'titulo': 'O Poderoso Chefão', 'genero': 'Drama', 'poster': 'https://via.placeholder.com/150', 'avaliacao': 5, 'descricao': 'A história de uma família mafiosa.'},
    {'titulo': 'De Volta para o Futuro', 'genero': 'Ficção Científica', 'poster': 'https://via.placeholder.com/150', 'avaliacao': 5, 'descricao': 'Viagens no tempo e aventuras.'},
    {'titulo': 'Jurassic Park', 'genero': 'Aventura', 'poster': 'https://via.placeholder.com/150', 'avaliacao': 4, 'descricao': 'Dinossauros em um parque temático.'},
    {'titulo': 'O Exorcista', 'genero': 'Terror', 'poster': 'https://via.placeholder.com/150', 'avaliacao': 3, 'descricao': 'Uma menina possuída por um demônio.'},
    {'titulo': 'Forrest Gump', 'genero': 'Drama', 'poster': 'https://via.placeholder.com/150', 'avaliacao': 5, 'descricao': 'A história de um homem com uma vida extraordinária.'},
]

# Função para calcular a probabilidade (sigmoide)
def calcular_probabilidade(nota_usuario, nota_filme):
    return 1 / (1 + math.exp(-(nota_usuario - nota_filme)))

# Rota para a página inicial
@app.route('/')
def inicio():
    return render_template_string('''
        <!DOCTYPE html>
        <html lang="pt-br">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Recomendações de Filmes</title>
            <style>
                body { font-family: Arial, sans-serif; }
                .container { width: 80%; margin: 0 auto; text-align: center; }
                .card { display: inline-block; width: 200px; margin: 10px; padding: 15px; border: 1px solid #ccc; }
                .card img { width: 100%; height: auto; }
                .card h3 { font-size: 1.2em; }
                .btn { padding: 10px 20px; background-color: #007BFF; color: white; text-decoration: none; border-radius: 5px; }
                .btn:hover { background-color: #0056b3; }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>Recomendações de Filmes</h1>
                <a href="{{ url_for('explorar') }}" class="btn">Explorar Filmes</a> |
                <a href="{{ url_for('minha_lista') }}" class="btn">Minha Lista</a> |
                <a href="{{ url_for('minhas_notas') }}" class="btn">Minhas Notas</a> |
                <a href="{{ url_for('reset') }}" class="btn">Resetar</a>
                <h2>Filmes Recomendados</h2>
                <div class="recomendacoes">
                    {% for filme in filmes %}
                        <div class="card">
                            <img src="{{ filme['poster'] }}" alt="{{ filme['titulo'] }}">
                            <h3>{{ filme['titulo'] }}</h3>
                            <p>{{ filme['descricao'] }}</p>
                            <p>Avaliação: {{ filme['avaliacao'] }} / 5</p>
                            <p>Probabilidade de você gostar: {{ 100 | round(2) }}%</p>
                            <a href="{{ url_for('detalhes', filme_id=loop.index0) }}" class="btn">Ver Detalhes</a>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </body>
        </html>
    ''', filmes=filmes)

# Rota para a página de explorar
@app.route('/explorar')
def explorar():
    return render_template_string('''
        <!DOCTYPE html>
        <html lang="pt-br">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Explorar Filmes</title>
            <style>
                body { font-family: Arial, sans-serif; }
                .container { width: 80%; margin: 0 auto; text-align: center; }
                .card { display: inline-block; width: 200px; margin: 10px; padding: 15px; border: 1px solid #ccc; }
                .card img { width: 100%; height: auto; }
                .card h3 { font-size: 1.2em; }
                .btn { padding: 10px 20px; background-color: #007BFF; color: white; text-decoration: none; border-radius: 5px; }
                .btn:hover { background-color: #0056b3; }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>Explorar Filmes</h1>
                <a href="{{ url_for('inicio') }}" class="btn">Voltar para Início</a>
                <h2>Filmes Disponíveis</h2>
                <div class="recomendacoes">
                    {% for filme in filmes %}
                        <div class="card">
                            <img src="{{ filme['poster'] }}" alt="{{ filme['titulo'] }}">
                            <h3>{{ filme['titulo'] }}</h3>
                            <p>{{ filme['descricao'] }}</p>
                            <p>Avaliação: {{ filme['avaliacao'] }} / 5</p>
                            <a href="{{ url_for('detalhes', filme_id=loop.index0) }}" class="btn">Ver Detalhes</a>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </body>
        </html>
    ''', filmes=filmes)

# Rota para a página de detalhes do filme
@app.route('/detalhes/<int:filme_id>')
def detalhes(filme_id):
    filme = filmes[filme_id]
    return render_template_string('''
        <!DOCTYPE html>
        <html lang="pt-br">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Detalhes do Filme</title>
            <style>
                body { font-family: Arial, sans-serif; }
                .container { width: 80%; margin: 0 auto; text-align: center; }
                .card { width: 100%; padding: 15px; border: 1px solid #ccc; margin-top: 20px; }
                .card img { width: 200px; height: auto; display: block; margin: 0 auto; }
                .btn { padding: 10px 20px; background-color: #007BFF; color: white; text-decoration: none; border-radius: 5px; }
                .btn:hover { background-color: #0056b3; }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>{{ filme['titulo'] }}</h1>
                <div class="card">
                    <img src="{{ filme['poster'] }}" alt="{{ filme['titulo'] }}">
                    <h3>{{ filme['titulo'] }}</h3>
                    <p>{{ filme['descricao'] }}</p>
                    <p>Avaliação: {{ filme['avaliacao'] }} / 5</p>
                    <a href="{{ url_for('explorar') }}" class="btn">Voltar para Explorar</a>
                </div>
            </div>
        </body>
        </html>
    ''', filme=filme)

# Rota para a página da minha lista
@app.route('/minha_lista')
def minha_lista():
    return render_template_string('''
        <html>
        <body>
        <h1>Minha Lista</h1>
        <p>Em breve!</p>
        </body>
        </html>
    ''')

# Rota para as minhas notas
@app.route('/minhas_notas')
def minhas_notas():
    return render_template_string('''
        <html>
        <body>
        <h1>Minhas Notas</h1>
        <p>Em breve!</p>
        </body>
        </html>
    ''')

#
